<app-navbar></app-navbar>
<br /><br /><br /><br />
<div class="container">
  <h2>Reports</h2>
  <div class="row  main-header text-center">
    <div class="nav-buttons">
      <button class="active" (click)="toggleView($event,0)">Consultations</button>
      <button *ngIf="selectedUser.role==='patient'" (click)="toggleView($event,1)">Vital Reports</button>
    </div>
    <div class="nav-date">
      <div class="left-arrow" mwlCalendarPreviousView [view]="view" [(viewDate)]="viewDate"
        (viewDateChange)="closeOpenMonthViewDay()">
        <i class="fa fa-2x fa-angle-left" aria-hidden="true"></i>
      </div>
      <h3>{{ viewDate | calendarDate:(view + 'ViewTitle'):'en' }}</h3>
      <div class="right-arrow" mwlCalendarNextView [view]="view" [(viewDate)]="viewDate"
        (viewDateChange)="closeOpenMonthViewDay()">
        <i class="fa fa-2x fa-angle-right" aria-hidden="true"></i>
      </div>
    </div>
    <div class="nav-span">
      <button>TODAY</button>
      <div class="month" (click)="setView(CalendarView.Month, $event)" [class.active]="view === CalendarView.Month">
        31
      </div>
      <div class="week" (click)="setView(CalendarView.Week, $event)" [class.active]="view === CalendarView.Week">
        7
      </div>
    </div>

  </div>
  <ng-container *ngIf="consultationEvents">
    <div [ngSwitch]="view" *ngIf="showConsultation; else showReports">
      <mwl-calendar-month-view [cellTemplate]="monthCellTemplate" *ngSwitchCase="CalendarView.Month"
        [viewDate]="viewDate" [events]="consultationEvents" [refresh]="refresh" [activeDayIsOpen]="activeDayIsOpen"
        (eventTimesChanged)="eventTimesChanged($event)">
      </mwl-calendar-month-view>
      <mwl-calendar-week-view *ngSwitchCase="CalendarView.Week" [eventTemplate]="weekEventTemplate"
        [viewDate]="viewDate" [events]="consultationEvents" [dayStartHour]="10" [dayEndHour]="22" [refresh]="refresh">
      </mwl-calendar-week-view>
    </div>
  </ng-container>
  <ng-template #showReports>
    <div [ngSwitch]="view">
      <mwl-calendar-month-view *ngSwitchCase="CalendarView.Month" [cellTemplate]="monthCellTemplateReports" [viewDate]="viewDate" [events]="reportEvents"
        [refresh]="refresh" [activeDayIsOpen]="activeDayIsOpen">
      </mwl-calendar-month-view>
      <mwl-calendar-week-view *ngSwitchCase="CalendarView.Week" [eventTemplate]="weekEventTemplate" [viewDate]="viewDate" [events]="reportEvents"
        [dayStartHour]="10" [dayEndHour]="22" [refresh]="refresh">
      </mwl-calendar-week-view>
    </div>
  </ng-template>
</div>

<!-- Template for month cell for Consultations-->
<ng-template #monthCellTemplate let-day="day" let-openDay="openDay" let-locale="locale"
  let-tooltipPlacement="tooltipPlacement" let-highlightDay="highlightDay" let-unhighlightDay="unhighlightDay"
  let-eventClicked="eventClicked" let-tooltipTemplate="tooltipTemplate" let-tooltipAppendToBody="tooltipAppendToBody">
  <div class="cal-cell-top">
    <span class="cal-day-number">{{ day.date | calendarDate:'monthViewDayNumber':locale }}</span>
  </div>
  <div class="cal-events" *ngIf="day.events.length > 0">
    <ng-container *ngFor="let event of day.events.slice(0,2); trackBy:trackByEventId">
      <ng-template [ngTemplateOutlet]="eventHoverTemplateMonth" [ngTemplateOutletContext]="{event: event}">
      </ng-template>
    </ng-container>
    <span *ngIf="day.events.length > 2" (click)="setView(CalendarView.Week,day.events[0].start)">More</span>
  </div>
</ng-template>
<!-- Template for Month cell end for Consultations-->

<!-- Template for month cell for Reports-->
<ng-template #monthCellTemplateReports let-day="day" let-openDay="openDay" let-locale="locale"
  let-tooltipPlacement="tooltipPlacement" let-highlightDay="highlightDay" let-unhighlightDay="unhighlightDay"
  let-eventClicked="eventClicked" let-tooltipTemplate="tooltipTemplate" let-tooltipAppendToBody="tooltipAppendToBody">
  <div class="cal-cell-top">
    <span class="cal-day-number">{{ day.date | calendarDate:'monthViewDayNumber':locale }}</span>
  </div>
  <div class="cal-events" *ngIf="day.events.length > 0">
    <span (click)="setWeekView(CalendarView.Week,day.events[0].start)">{{day.events.length}} Reports</span>
      <ng-template [ngTemplateOutlet]="eventHoverTemplateMonthReports" [ngTemplateOutletContext]="{events: day.events}">
      </ng-template>
  </div>
</ng-template>
<!-- Template for Month cell end Reports-->


<!-- Template for eventHoverInfo for consultations -->
<ng-template let-event="event" #eventHoverTemplateMonth>
  <span>Details</span>
  <ng-template [ngTemplateOutlet]="eventHoverTemplate" [ngTemplateOutletContext]="{event:event}"></ng-template>
</ng-template>
<!-- Template End for eventHoverInfo for consultations-->

<!-- Template for eventHoverInfo for reports -->
<ng-template let-events="events" #eventHoverTemplateMonthReports>
  <div class="reports">
      <div class="report-info" *ngFor="let event of events">
        <span>{{event.reportname}}</span>
        <a (click)="downloadItem(event.url, $event)" download>DOWNLOAD</a>
      </div>
  </div>
</ng-template>
<!-- Template End for eventHoverInfo for reports-->


<!-- Template for Week Event Start for consultations-->
<ng-template #weekEventTemplate let-event="weekEvent.event" let-tooltipDisabled="tooltipDisabled">
  <div class="week-consultations shadow">
    <img [src]="event.picUrl | safe:'url'">
    <div class="doctor-info">
      <div class="doctor-name">
        {{event.doctorName}}
      </div>
      <span>{{event.qualification}}</span>
    </div>
  </div>
  <ng-template [ngTemplateOutlet]="eventHoverTemplate" [ngTemplateOutletContext]="{event: event}"></ng-template>
</ng-template>
<!-- Template for Week Event End for consultations-->

<!-- Template for Week Event Hover Start for consultations-->
<ng-template let-event="event" #eventHoverTemplate>
  <div class="consultation-info">
    <div class="consultation-info-header">
      <img [src]="event.picUrl | safe:'url'">
      <div class="consultation-doc-name">
        <div>{{event.doctorName}}</div>
        <span>{{event.qualification}}</span>
      </div>
      <button *ngIf="event.prescriptionUrl">DOWNLOAD</button>
    </div>
    <div class="consultation-time">
      <div>{{event.start | date:'dd MMM,yyyy h:mm:ss a'}} to {{event.end | date:'dd MMM,yyyy h:mm:ss a'}}</div>
    </div>
    <div class="consultation-summary"> <span>Report Summary</span>
      <div>{{event.summary}}</div>
    </div>
  </div>
</ng-template>
<!-- Template for Week Event Hover End for consultations-->
